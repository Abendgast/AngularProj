<div class="simple-mode-wrap">
  <header class="simple-header">
    <h1>ğŸ§© Fix the Interface</h1>
    <button class="btn btn-secondary" (click)="goBack()">
      <span class="btn-icon">â†</span> Back to Menu
    </button>
  </header>
  
  <!-- Tool Selection Panel -->
  <div class="tool-panel" *ngIf="state$ | async as state">
    <div class="tool-panel-title">Select Tool:</div>
    <div class="tool-buttons">
      <button 
        class="tool-btn" 
        [class.active]="currentToolType === 'brush'"
        (click)="selectTool('brush')"
        [title]="'Brush - Use for painting'">
        <span class="tool-icon">ğŸ–Œï¸</span>
        <span class="tool-name">Brush</span>
      </button>
      <button 
        class="tool-btn" 
        [class.active]="currentToolType === 'hammer'"
        (click)="selectTool('hammer')"
        [title]="'Hammer - Use for cracks and breaks'">
        <span class="tool-icon">ğŸ”¨</span>
        <span class="tool-name">Hammer</span>
      </button>
      <button 
        class="tool-btn" 
        [class.active]="currentToolType === 'wrench'"
        (click)="selectTool('wrench')"
        [title]="'Wrench - Use for screws'"
        [disabled]="state.level < 3">
        <span class="tool-icon">ğŸ”§</span>
        <span class="tool-name">Wrench</span>
      </button>
      <button 
        class="tool-btn" 
        [class.active]="currentToolType === 'pliers'"
        (click)="selectTool('pliers')"
        [title]="'Pliers - Use for wires'"
        [disabled]="state.level < 4">
        <span class="tool-icon">ğŸ”Œ</span>
        <span class="tool-name">Pliers</span>
      </button>
    </div>
  </div>

  <div class="simple-mode-container" *ngIf="state$ | async as state">
    <!-- Debug info -->
    <div style="position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; z-index: 20000; font-size: 12px;">
      Defects: {{ state.defects.length }}<br>
      Fixed: {{ getFixedCount(state.defects) }}<br>
      Level: {{ state.level }}
    </div>
    <div class="simple-hud">
      <div class="hud-item">
        <div class="hud-icon">âš™ï¸</div>
        <div class="hud-value">Level {{ state.level }} - {{ getLevelName(state.level) }}</div>
      </div>
      <div class="hud-item">
        <div class="hud-icon">âœ…</div>
        <div class="hud-value">{{ getFixedCount(state.defects) }} / {{ state.defects.length }}</div>
      </div>
      <div class="hud-item">
        <div class="hud-icon">â±ï¸</div>
        <div class="hud-value">{{ formatTime(elapsedTime) }}</div>
      </div>
    </div>

    <div class="simple-board" 
         (mousemove)="onMouseMove($event)"
         (mouseup)="onMouseUp($event)"
         (wheel)="onMouseWheel($event)">
      
      <!-- Tool (selected by user) -->
      <div class="tool" 
           [class.brush]="currentToolType === 'brush'"
           [class.hammer]="currentToolType === 'hammer'"
           [class.wrench]="currentToolType === 'wrench'"
           [class.pliers]="currentToolType === 'pliers'"
           [style.left.px]="hammerPosition.x"
           [style.top.px]="hammerPosition.y"
           [class.dragging]="isDragging"
           [class.hovering]="hoveredDefect !== null"
           [class.painting]="currentToolType === 'brush' && isDragging && hoveredDefect !== null"
           (mousedown)="onHammerMouseDown($event)"
           [style.display]="'flex'"
           [style.opacity]="1"
           [style.visibility]="'visible'">
        <span *ngIf="currentToolType === 'brush'">ğŸ–Œï¸</span>
        <span *ngIf="currentToolType === 'hammer'">ğŸ”¨</span>
        <span *ngIf="currentToolType === 'wrench'">ğŸ”§</span>
        <span *ngIf="currentToolType === 'pliers'">ğŸ”Œ</span>
      </div>

      <!-- Defects -->
      <div *ngFor="let defect of state.defects; trackBy: trackByDefectId" 
           class="simple-defect"
           [attr.data-defect-id]="defect.id"
           [class.fixed]="defect.fixed"
           [class.hovered]="hoveredDefect === defect.id"
           [style.left.px]="defect.x"
           [style.top.px]="defect.y"
           [style.display]="'flex'"
           [style.opacity]="1"
           [style.visibility]="'visible'"
           [class.crack]="defect.type === 'crack'"
           [class.screw]="defect.type === 'screw'"
           [class.wire]="defect.type === 'wire'"
           [class.paint]="defect.type === 'paint'">
        
        <!-- Simple defect -->
        <div *ngIf="defect.type === 'simple'" class="defect-content">
          <div class="defect-icon">ğŸ’¥</div>
          <div class="defect-label">{{ defect.fixed ? 'âœ“ Fixed' : (state.level === 1 ? 'Paint me' : 'Hit me') }}</div>
          <div class="paint-progress" *ngIf="state.level === 1 && !defect.fixed">
            <div class="paint-bar" [style.width.%]="paintProgress[defect.id] || 0"></div>
            <div class="paint-text">{{ (paintProgress[defect.id] || 0) >= 100 ? 'Ready! Click to fix' : (hoveredDefect === defect.id ? 'Painting...' : 'Paint me') }}</div>
          </div>
        </div>

        <!-- Crack defect -->
        <div *ngIf="defect.type === 'crack'" class="defect-content">
          <div class="defect-icon">âš¡</div>
          <div class="defect-label">{{ defect.fixed ? 'âœ“ Fixed' : 'Hammer me' }}</div>
          <div class="hold-progress" *ngIf="hoveredDefect === defect.id && !defect.fixed">
            <div class="hold-bar" [style.width.%]="holdProgress"></div>
            <div class="hold-text">{{ holdProgress >= 100 ? 'Ready!' : 'Hold...' }}</div>
          </div>
        </div>

        <!-- Screw defect -->
        <div *ngIf="defect.type === 'screw'" class="defect-content">
          <div class="defect-icon" [style.transform]="'rotate(' + (defect.ui?.rotation || 0) + 'deg)'">ğŸ”©</div>
          <div class="defect-label">{{ defect.fixed ? 'âœ“ Fixed' : 'Rotate me' }}</div>
          <div class="circular-progress" *ngIf="hoveredDefect === defect.id && !defect.fixed">
            <div class="progress-text">{{ circularProgress }}%</div>
          </div>
        </div>

        <!-- Wire defect -->
        <div *ngIf="defect.type === 'wire'" class="defect-content wire-content">
          <div class="wire-end" 
               [class.connected]="defect.ui?.connected"
               [class.can-drag]="!defect.fixed && !defect.ui?.connected"
               draggable="true"
               (dragstart)="onWireDragStart($event, defect)"
               (drop)="onWireDrop($event, defect)"
               (dragover)="allowDrop($event)">
            <div class="wire-icon">ğŸ”Œ</div>
            <div class="wire-hint" *ngIf="!defect.fixed && !defect.ui?.connected">â† Drag</div>
          </div>
          <div class="defect-label">
            <span *ngIf="defect.fixed">âœ“ Fixed</span>
            <span *ngIf="!defect.fixed && defect.ui?.connected">âœ“ Connected - Use pliers!</span>
            <span *ngIf="!defect.fixed && !defect.ui?.connected">Connect me</span>
          </div>
        </div>

        <!-- Paint defect -->
        <div *ngIf="defect.type === 'paint'" class="defect-content paint-content">
          <div class="defect-icon">ğŸ¨</div>
          <div class="defect-label">{{ defect.fixed ? 'âœ“ Fixed' : 'Paint me' }}</div>
          <div class="paint-progress" *ngIf="hoveredDefect === defect.id && !defect.fixed">
            <div class="paint-bar" [style.width.%]="paintProgress[defect.id] || 0"></div>
            <div class="paint-text">{{ (paintProgress[defect.id] || 0) >= 100 ? 'Ready!' : 'Paint...' }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Level Complete Message -->
    <div class="level-complete" *ngIf="state.levelComplete">
      <div class="complete-content">
        <h2>Level Complete!</h2>
        <p *ngIf="state.level < 5" class="auto-advance">Advancing to Level {{ state.level + 1 }}...</p>
        <button class="btn btn-primary" (click)="simpleModeService.nextLevel()" *ngIf="state.level < 5">
          Next Level Now
        </button>
        <div *ngIf="state.level >= 5" class="complete-message">
          <p>ğŸ‰ Congratulations! You completed all Simple Mode levels!</p>
          <button class="btn btn-secondary" (click)="goBack()">Back to Menu</button>
        </div>
      </div>
    </div>
  </div>
</div>

